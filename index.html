<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>AI Chat</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #000;
  color: #fff;
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.container {
  width: 90%;
  max-width: 700px;
  height: 90vh;
  display: flex;
  flex-direction: column;
  background: #111;
  padding: 10px;
}
#chat {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 5px;
}
.message {
  padding: 10px;
  max-width: 80%;
  word-wrap: break-word;
  background: #fff;
  color: #000;
}
.user {
  align-self: flex-end;
  text-align: right;
}
.ai {
  align-self: flex-start;
  text-align: left;
}
.input-area {
  display: flex;
  margin-top: 10px;
}
input {
  flex: 1;
  padding: 15px;
  border: none;
  background: #222;
  color: #fff;
  font-size: 16px;
}
button {
  width: 100px;
  padding: 15px;
  border: none;
  background: #fff;
  color: #000;
  cursor: pointer;
  font-size: 16px;
  margin-left: 10px;
}
button:hover {
  background: #ccc;
}
#controls {
  position: absolute;
  left: 10px;
  top: 10px;
  display: flex;
  flex-direction: column;
  gap: 5px;
}
#controls button {
  width: 80px;
  padding: 8px;
  font-size: 14px;
  background: #fff;
  color: #000;
  margin-left: 0;
}
#controls button:hover {
  background: #ccc;
}
</style>
</head>
<body>

<div class="container">
  <div id="controls">
    <button onclick="saveSession()">Save</button>
    <button onclick="loadSession()">Load</button>
  </div>
  <div id="chat"></div>
  <div class="input-area">
    <input id="query" placeholder="Type your message..." />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
const chat = document.getElementById('chat');

// Generate a random session ID if none exists
let sessionId = localStorage.getItem("sessionId");
if (!sessionId) {
  sessionId = Math.floor(Math.random() * 1000000000);
  localStorage.setItem("sessionId", sessionId);
}

// Send message to Worker
async function sendMessage() {
  const input = document.getElementById('query');
  const userMessage = input.value.trim();
  if (!userMessage) return;

  appendMessage(userMessage, 'user');
  input.value = '';

  // Typing dots
  const typingDiv = appendMessage("Typing", 'ai');
  let dots = 0;
  const typingInterval = setInterval(() => {
    dots = (dots + 1) % 4;
    typingDiv.textContent = "Typing" + ".".repeat(dots);
    chat.scrollTop = chat.scrollHeight;
  }, 500);

  try {
    const res = await fetch("https://morning-mud-34ab.joelrobinson-fit.workers.dev/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: userMessage, session: sessionId })
    });

    const data = await res.json();
    clearInterval(typingInterval);
    typingDiv.textContent = data.answer;
    chat.scrollTop = chat.scrollHeight;

  } catch (err) {
    clearInterval(typingInterval);
    typingDiv.textContent = "Error: " + err.toString();
  }
}

// Append message to chat
function appendMessage(text, type) {
  const div = document.createElement('div');
  div.className = 'message ' + type;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  return div;
}

// Save current session ID for later
function saveSession() {
  const saved = prompt("Enter a number to save this conversation:");
  if (saved) {
    localStorage.setItem("savedSession", sessionId);
    alert("Conversation saved! Use Load to restore.");
  }
}

// Load saved session
function loadSession() {
  const saved = localStorage.getItem("savedSession");
  if (saved) {
    sessionId = saved;
    alert("Loaded saved conversation!");
    chat.innerHTML = "";
  } else {
    alert("No saved conversation found.");
  }
}
</script>

</body>
</html>
